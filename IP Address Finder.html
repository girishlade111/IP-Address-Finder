<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Address Finder</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <h1 class="text-4xl font-bold text-center mb-8 text-blue-600">IP Address Finder</h1>

        <!-- Search Form -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <form id="ipForm" class="flex flex-col md:flex-row gap-4">
                <input type="text" id="ipInput" 
                    class="flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter IP address">
                <button type="submit" 
                    class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">
                    Search
                </button>
            </form>
            <div id="error" class="text-red-500 mt-2 hidden"></div>
        </div>

        <!-- Loading Spinner -->
        <div id="loading" class="text-center hidden">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-500 border-t-transparent"></div>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <h2 class="text-xl font-semibold mb-4">Network Information</h2>
                    <div id="ipDetails" class="space-y-2"></div>
                    <button id="copyBtn" class="mt-4 bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">
                        Copy to Clipboard
                    </button>
                </div>
                <div>
                    <h2 class="text-xl font-semibold mb-4">Location Map</h2>
                    <div id="map" class="h-64 rounded-lg"></div>
                </div>
            </div>
            
            <!-- Security Check -->
            <div class="mt-6 pt-6 border-t">
                <label class="flex items-center space-x-2">
                    <input type="checkbox" id="securityCheck" class="form-checkbox">
                    <span>Check for VPN/Proxy</span>
                </label>
                <div id="securityResult" class="mt-2 hidden"></div>
            </div>
        </div>

        <!-- Educational Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <details>
                <summary class="font-semibold cursor-pointer">About IP Addresses & Privacy</summary>
                <p class="mt-2 text-gray-600">
                    Your IP address reveals general geographical information and network details. 
                    While this tool provides approximate location data, actual physical addresses 
                    cannot be determined. Always be cautious about sharing IP information and 
                    consider using VPNs for enhanced privacy.
                </p>
            </details>
        </div>
    </div>

    <script>
        let map;
        let currentMarker;
        const API_BASE = 'https://ipapi.co';
        const VPN_API = 'https://ipqualityscore.com/api/json/ip';

        // Initialize map
        function initMap(lat = 0, lon = 0) {
            if (map) map.remove();
            map = L.map('map').setView([lat, lon], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            currentMarker = L.marker([lat, lon]).addTo(map);
        }

        // Fetch IP data
        async function fetchIPData(ip) {
            try {
                const response = await fetch(`${API_BASE}/${ip}/json/`);
                return await response.json();
            } catch (error) {
                throw new Error('Failed to fetch IP data');
            }
        }

        // Check VPN/Proxy
        async function checkSecurity(ip) {
            try {
                const response = await fetch(`${VPN_API}/YOUR_API_KEY/${ip}`);
                const data = await response.json();
                return data;
            } catch (error) {
                throw new Error('Security check failed');
            }
        }

        // Display results
        function displayResults(data) {
            const detailsDiv = document.getElementById('ipDetails');
            detailsDiv.innerHTML = `
                <p><strong>IP:</strong> ${data.ip}</p>
                <p><strong>Location:</strong> ${data.city}, ${data.region}, ${data.country_name}</p>
                <p><strong>ISP:</strong> ${data.org}</p>
                <p><strong>Timezone:</strong> ${data.timezone}</p>
                <p><strong>ASN:</strong> ${data.asn}</p>
                <p><strong>Hostname:</strong> ${data.hostname || 'N/A'}</p>
            `;
            
            initMap(data.latitude, data.longitude);
            document.getElementById('results').classList.remove('hidden');
        }

        // Form submission
        document.getElementById('ipForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const ipInput = document.getElementById('ipInput');
            const ip = ipInput.value.trim();
            
            if (!isValidIP(ip)) {
                showError('Invalid IP address format');
                return;
            }

            try {
                toggleLoading(true);
                const data = await fetchIPData(ip);
                displayResults(data);

                if (document.getElementById('securityCheck').checked) {
                    const securityData = await checkSecurity(ip);
                    displaySecurityResults(securityData);
                }
            } catch (error) {
                showError(error.message);
            } finally {
                toggleLoading(false);
            }
        });

        // Initial load with user's IP
        window.onload = async () => {
            try {
                const data = await fetchIPData('');
                document.getElementById('ipInput').value = data.ip;
                displayResults(data);
            } catch (error) {
                showError('Failed to load initial IP data');
            }
        };

        // Utility functions
        function isValidIP(ip) {
            const ipv4Pattern = /^(?:\d{1,3}\.){3}\d{1,3}$/;
            const ipv6Pattern = /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/;
            return ipv4Pattern.test(ip) || ipv6Pattern.test(ip);
        }

        function toggleLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 3000);
        }

        // Clipboard functionality
        new ClipboardJS('#copyBtn', {
            text: () => document.getElementById('ipDetails').innerText
        });

        // Security check display
        function displaySecurityResults(data) {
            const securityDiv = document.getElementById('securityResult');
            securityDiv.innerHTML = `
                <p>VPN: ${data.vpn ? 'Detected' : 'Not detected'}</p>
                <p>Proxy: ${data.proxy ? 'Detected' : 'Not detected'}</p>
                <p>Risk Score: ${data.risk_score}/100</p>
            `;
            securityDiv.classList.remove('hidden');
        }
    </script>
</body>
</html>